# ---------------------------------------------------------------------------------
# é‘“å¡µå¹—è†‚è“¿få¯¥å¯¢è†ƒæš ç˜‰ç”…ç”ƒæ§Šæ§fç¢£ç¶®ç˜‹èŸç¢¯é¢±äº¦å°“ãi:i:i;;:;:: : :
# æ¾£å¹—å¶Œå¡¹å‚´å«©æ¦›ç•çš‹iè¢è€˜èšŒç´•æ¬’å„¼å·“è¥´è¸Ÿç¯fç½µfäº¦å°“ãi:i:i;;:;:: : :
# æ¼²è”­ç”ƒç¸Ÿè«›féº­çª¶è†©Iå¶®è–¤ç¯çˆ°æ›·æ¨”é»ãŒ¢Â´ã€€ã€€ï½€â…·è¸Ÿäº¦å°“ãi:i:i;;:;:: : :
# è”•æ¼“æ»¿fè•“èŸ‡è¸´fæ­™è‰‡è‰€è£²fçšé³«å·“è¥´éª¸ã€€ã€€ã€€ã€€ã€€è´’æ†Šäº¦å°“ãi:i:i;;:;:: : :
# æ¦Šç”ƒé½Šçˆ°fæ‡ˆæ©ˆç‡—æ®ªå¹¢ç·»Iç¿°å„‚æ¨”é»å¤¢'â€ã€€ ã€€ ,ï½¨å‚¾ç¯©ç¸’äº¦å°“ãi:i:i;;:;:: : :
# ç®‹èšèœšå£ŠåŠ‘è–¯iæš¹ç›¥çš‹è¢iè€˜èšŒç´•å¸â€²ã€€ã€€ã€€ é›«å¯¬Içˆ°æ›·fäº¦å°“ãi:i:i;;:;:: : :
# éŠ•é¢±éº¼å¯°ç¯è‚å¾‘æ‚—fç¯åš ç¯©iç¸’ç¸¡é½¢ã€€ã€€ ã€€ ã€€ â…§è¾¨fç¯Ié‹—fäº¦å°“ãi:i:i;;:; : : .
# ç¢¯èŸfç¶´éº¼è¾¨è¢fç’Ÿè¼¯é§²fè¿¯ç“²iè»Œå¸¶â€²ã€€ã€€ã€€ã€€ã€€`å®ˆIå–å­©få¥äº¦å°“ãi:i:i;;:;:: : : .
# ç¶®èª£æ’’fæ›·ç£”ç‘©å¾·få¹¢å„‚å„¼å·“è¥´ç·²â€²ã€€ ã€€ ã€€ ã€€ ã€€ `å®ˆæ¢iç£¬å»›iäº¦å°“ãi:i:i;;:;:: : : .
# æ…«å¯«å» å¾‘æ‚—ç·fç¯åš ç¯©Iç¸’ç¸¡å¤¢'Â´ã€€ã€€ã€€ ã€€ ã€€ ã€€ ã€€ ã€€ `å®ˆå³½få¾‘æ‚—fäº¦å°“ãi:i:i;;:;:: : : .
# å»›åƒµIæ•¸ç•ç¯¥Iç†¾é¾èšŒç´•è¥´ç·²â€²ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€â€˜å®ˆç•çš‹å¼ŠiåŠäº¦å°“ãi:i:i;;:;:: : : .
# ç˜§iæ§²ç‘©fæ¢ç¯ç£¬æ›·fç“²è»Œæ„â€²ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€,gfæ¯¯ç¶´å¾‘æ‚—åš è¿©å¿™äº¦å°“ãi:i:i;;:;::
# è¥´ç½©ç¡¼fè‰‡è‰€è£²çšé³«è¥´é‘¿ç·²'ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ ã€€ ã€€ å¥ªå¯”få¦å‚€æµçŒ¯içˆ¾è¿©å¿™äº¦å°“ãi:i:
# æ¤ˆæ£˜æ–çŠ€è€‹çµçµ²çµ¨ç·²â€²ã€€ã€€ã€€ã€€ã€€ã€€ ã€€ ã€€ ã€€ ã€€ ã€€ ã€€ ã€€ â€'ç½¨æ‚³èªfè’‚æ¸¹å¹‡få»è¿©å¿™iäº¦å°“ã
# æ½æ¨—Iç˜§å¾·å¹¢iå„‚å·“ç·²â€²ã€€ã€€ã€€ã€€ã€€ã€€ ã€€ ã€€ ã€€ ã€€ ã€€ ã€€ rã¡â„¡ã€Ÿâ€'ç½¨æ¤è£‚æ»…æ¥”æ»„æ„¼æ„°è¿©å¿™äº¦
# ç¿¦iç£…è‰˜æº²Iæ¦å„¼å·“ç™»zzz zzzãœãœï½§gã€€ ã€€ ç·² gã€€ ã€€ ç”¯é«”içˆºã‚ï½¡, â€'ç½¨ç¥ç„œæ¯³å¾­iåµ¬å¡°æ…çµ²
# æ¢ç¯ç£¬fæ›·è¿¯iç“²è»Œfè¥´æš¹ ç”¯å¹—ç·² ,fi'ã€€ã€€ ç·²',çºœï½¡ã€€ã€€è´’iç¶Ÿç¢•ç¢šçˆºã‚ï½¡ â€'ç½¨çš´ç™¼å‚²äº‚Ié»¹é±
# ç·æ„¾æ…Šåµ¬åµ¯æ¬’å„¼å·“è¥´é©« éœ¤Iç·² ,ç·²ã€€ã€€ ï¼‚,çºœç©ã€€ã€€ç”¯çµ›è·¨é£©ié«¢é¦³çˆºã‚ï½¡`'ç­‰èª„Iç­´ç¢ŒIç•·
# ç½©ç¡¼Iè’»ç­µç¡ºè‰‡è‰€iè£²çšäº€ ç¯³'â€™,ç·²ã€€ã€€gäº€ â…¦ilé½¢ã€€ã€€è´’ç½©ç¡¼iè‰‡è‰€è£²çšé³«çˆºé é£­è›¸Iè£˜è£”
# æ¤ˆfæ£˜è±¢è·«è·ªIè¡™çµçµ²çµ¨içˆºiãœiâ…£ ã€€ ,ç·²iäº€ â…¦éˆ,ã€€ã€€ç”¯å‚…å–©Iæµæšæƒ¹å±¡çµç—™æ£æ•è£”ç­´æ•¢
# é ¬iéè¤‚fè·«è©¹é›‹é«¢iæ›·è¿¯ç“²è»Œéœ¤ ã€€ ,ç·²è”­ç© â…¦ç© ã€€ è®æ¤ˆiæ£˜è²…fæ–çŠ€è€‹fçµçµ²è§šfè¦ƒé»¹é»
# è¥´è”½æˆ®è²²è‰€èˆ…Iè‚…è‚„è‚†æ§¿fè“â…§ ã€€ ç·²$æ…šIç©,ç–Šç©ã€€ ç”¯èªç¢¾fé‹—è¼œé fèª¹è‡§é‹©fè¤‚è·«è©¹ié›‹
# ---------------------------------------------------------------------------------
# ğŸŒ This project was created https://t.me/I_love_wizzy
# âš ï¸ Licensed under the GNU AGPLv3.
# ğŸ’¢ The owner of this script does not have any responsibility or intellectual property rights in relation to this script.
# ---------------------------------------------------------------------------------
# Name: TrollSpam
# Author: https://t.me/I_love_wizzy
# scope: heroku && hikka
# ---------------------------------------------------------------------------------
__version__ = (1, 0, 0)

import json
import aiohttp
import asyncio
from random import choice
from .. import loader, utils
from telethon.tl.types import Message

@loader.tds
class KomarutrollMod(loader.Module):
    """Module for insults, make the interlocuter depressed."""

    strings = {
        "name": "KomaruTroll",
        "error_key": "<b><i>Error: Key 'TrollText' not found.</i></b>",
        "error_decoding": "<b><i>Error: The JSON could not be decoded.</i></b>",
        "error_uploading_data": "<b><i>Error loading data</i></b>",
        "error_valid_args": "<b><i>Please enter valid arguments!</i></b>",
        "launched": "<b><i>KomaruTroll launched!</i></b>\n\n<b><i>Use <code>{prefix}komaruoff</code> to stop the attack.</i></b>",
        "stopped": "<b><i>KomaruTroll has stopped.</i></b>",
    }

    strings_ru = {
        "error_key": "<b><i>Error: ĞºĞ»ÑÑ‡ 'TrollText' Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½.</i></b>",
        "error_decoding": "<b><i>Error: Ğ½Ğµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ´ĞµĞºĞ¾Ğ´Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ JSON.</i></b>",
        "error_uploading_data": "<b><i>ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…</i></b>",
        "error_valid_args": "<b><i>Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ñ‹Ğµ Ğ°Ñ€Ğ³ÑƒĞ¼ĞµĞ½Ñ‚Ñ‹!</i></b>",
        "launched": "<b><i>KomaruTroll Ğ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½!</i></b>\n\n<b><i>Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ <code>{prefix}komaruoff</code>, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ°Ñ‚Ğ°ĞºÑƒ.</i></b>",
        "stopped": "<b><i>KomaruTroll Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½.</i></b>",
    }

    strings_uz = {
        "error_key": "<b><i>Error: 'TrollText' ĞºĞ°Ğ»Ğ¸Ñ‚Ğ¸ Ñ‚Ğ¾Ğ¿Ğ¸Ğ»Ğ¼Ğ°Ğ´Ğ¸.</i></b>",
        "error_decoding": "<b><i>Error: JSON Ğ´ĞµĞºĞ¾Ğ´Ğ»Ğ°Ñˆ Ğ¼ÑƒĞ²Ğ°Ñ„Ñ„Ğ°Ò›Ğ¸ÑÑ‚Ğ»Ğ¸ Ğ°Ğ¼Ğ°Ğ»Ğ³Ğ° Ğ¾ÑˆĞ¼Ğ°Ğ´Ğ¸.</i></b>",
        "error_uploading_data": "<b><i>ĞœĞ°ÑŠĞ»ÑƒĞ¼Ğ¾Ñ‚Ğ»Ğ°Ñ€ ÑĞºĞ»Ğ°Ğ± Ğ¾Ğ»Ğ¸Ğ½Ğ¼Ğ°Ğ´Ğ¸</i></b>",
        "error_valid_args": "<b><i>Iltimos, to'g'ri dalillarni kiriting!</i></b>",
        "launched": "<b><i>KomaruTroll ishga tushirildi!</i></b>\n\n<b><i>Hujumni toÊ»xtatish uchun <code>{prefix}komaruoff</code> dan foydalaning.</i></b>",
        "stopped": "<b><i>KomaruTroll to'xtadi.</i></b>",
    }

    strings_de = {
        "error_key": "<b><i>Error: Der SchlÃ¼ssel 'TrollText' wurde nicht gefunden.</i></b>",
        "error_decoding": "<b><i>Error: JSON konnte nicht decodiert werden.</i></b>",
        "error_uploading_data": "<b><i>Fehler beim Hochladen der Daten</i></b>",
        "error_valid_args": "<b><i>Bitte geben Sie gÃ¼ltige Argumente ein!</i></b>",
        "launched": "<b><i>KomaruTroll gestartet!</i></b>\n\n<b><i>Verwenden Sie <code>{prefix}komaruoff</code>, um den Angriff zu stoppen.</i></b>",
        "stopped": "<b><i>KomaruTroll hat angehalten.</i></b>",
    }

    strings_es = {
        "error_key": "<b><i>Error: No se encontrÃ³ la clave 'TrollText'.</i></b>",
        "error_decoding": "<b><i>Error: No se pudo decodificar JSON.</i></b>",
        "error_uploading_data": "<b><i>Error al cargar los datos</i></b>",
        "error_valid_args": "<b><i>Â¡Por favor ingrese argumentos vÃ¡lidos!</i></b>",
        "launched": "<b><i>Â¡KomaruTroll lanzado!</i></b>\n\n<b><i>Utiliza <code>{prefix}komaruoff</code> para detener el ataque.</i></b>",
        "stopped": "<b><i>KomaruTroll se ha detenido.</i></b>",
    }

    async def client_ready(self, client, db):
        self.client = client
        self.db = db
        self.is_active = False

    @loader.command(
        ru_doc="ĞÑĞºĞ¾Ñ€Ğ±Ğ¸Ñ‚Ğµ Ğ²Ğ°ÑˆĞµĞ³Ğ¾ ÑĞ¾Ğ±ĞµÑĞµĞ´Ğ½Ğ¸ĞºĞ°.",
        uz_doc="Suhbatdoshingizni insult qiling.",
        de_doc="Beleidigen Sie Ihren GesprÃ¤chspartner.",
        es_doc="Insulta a tu interlocutor.",
    )
    async def komarutroll(self, message):
        """Insult your interlocutor"""
        url = "https://raw.githubusercontent.com/komarulolll/herokutrollsr/main/TrollText.json"
        
        if not message.is_reply:
            await utils.answer(message, "<b><i>Reply to a message!</i></b>")
            return
        
        async with aiohttp.ClientSession() as session:
            async with session.get(url) as response:
                if response.status == 200:
                    response_text = await response.text()
                    try:
                        data = json.loads(response_text)
                        if "TrollText" in data and isinstance(data["TrollText"], list) and data["TrollText"]:
                            text = choice(data["TrollText"])
                            
                            replied_msg = await message.get_reply_message()
                            words = text.split()
                            
                            for word in words:
                                if not self.is_active:
                                    break
                                await self.client.send_message(
                                    message.chat_id,
                                    word,
                                    reply_to=replied_msg.id
                                )
                                await asyncio.sleep(0.1)
                                
                        else:
                            await utils.answer(message, self.strings("error_key"))
                    except json.JSONDecodeError:
                        await utils.answer(message, self.strings("error_decoding"))
                else:
                    await utils.answer(message, f"{self.strings('error_uploading_data')}: {response.status}")

    @loader.command(
        ru_doc="[time] [text] - Ğ—Ğ°ÑĞ¿Ğ°Ğ¼Ñ‚Ğµ Ğ¾ÑĞºĞ¾Ñ€Ğ±Ğ»ĞµĞ½Ğ¸ÑĞ¼Ğ¸ Ğ²Ğ°ÑˆĞµĞ³Ğ¾ ÑĞ¾Ğ±ĞµÑĞµĞ´Ğ½Ğ¸ĞºĞ°",
        uz_doc="[time] [text] - Suhbatdoshingizni haqorat bilan spam qiling",
        de_doc="[time] [text] - Spammen Sie Ihren GesprÃ¤chspartner mit Beleidigungen zu",
        es_doc="[time] [text] - Spamea a tu interlocutor con insultos",
    )
    async def komaruspam(self, message: Message):
        """[time] [text] - Spam your interlocutor with insults"""
        url = "https://raw.githubusercontent.com/komarulolll/herokutrollsr/main/TrollText.json"
        args = utils.get_args(message)

        if not message.is_reply:
            await utils.answer(message, "<b><i>Reply to a message!</i></b>")
            return

        if not args:
            await utils.answer(message, self.strings("error_valid_args"))
            return
        else:
            self.is_active = True

        try:
            time = float(args[0])
            text = ' '.join(args[1:]) + " " if len(args) > 1 else ""
        except ValueError:
            await utils.answer(message, self.strings("error_valid_args"))
            return

        await utils.answer(message, self.strings("launched").format(prefix=self.get_prefix()))
        
        replied_msg = await message.get_reply_message()
        
        async with aiohttp.ClientSession() as session:
            async with session.get(url) as response:
                if response.status == 200:
                    response_text = await response.text()
                    
                    try:
                        data = json.loads(response_text)
                        if "TrollText" in data and isinstance(data["TrollText"], list) and data["TrollText"]:
                            while self.is_active:
                                bull_text = choice(data["TrollText"])
                                words = bull_text.split()
                                for word in words:
                                    if not self.is_active:
                                        break
                                    await message.client.send_message(
                                        message.chat_id,
                                        word,
                                        reply_to=replied_msg.id
                                    )
                                    await asyncio.sleep(0.1)
                                await asyncio.sleep(time)
                            return
                        else:
                            return await utils.answer(message, self.strings("error_key"))
                    except json.JSONDecodeError:
                        return await utils.answer(message, self.strings("error_decoding"))
                else:
                    return await utils.answer(message, f"{self.strings('error_uploading_data')}: {response.status}")

    @loader.command(
        ru_doc="ĞÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¾ÑĞºĞ¾Ñ€Ğ±Ğ»ĞµĞ½Ğ¸Ñ",
        uz_doc="Haqoratlarni to'xtating",
        de_doc="HÃ¶rt auf mit den Beleidigungen",
        es_doc="basta de insultos",
    )
    async def komaruoff(self, message: Message):
        """Stop the insults"""
        self.is_active = False
        await utils.answer(message, self.strings("stopped"))
        return
